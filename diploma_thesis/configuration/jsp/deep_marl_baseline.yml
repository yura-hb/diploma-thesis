jsp: &jsp
  name: 'policy'
  output_dir: 'tmp/jsp_deep_marl'
  log_stdout: False

  machine_agent:
    kind: 'mod'
    parameters:
      base_path: 'configuration/mods/machine_agent/policy.yml'
      mods: [ ]

  work_center_agent:
    kind: 'static'
    parameters:
      model:
        kind: 'static'
        parameters:
          rule: 'et'
      encoder:
        kind: 'plain'

  tape:
    machine_reward:
      kind: 'global_tardiness'
      parameters:
        span: 256

    work_center_reward:
      kind: 'no'

  simulator:
    kind: 'td'

  run:
    kind: 'mod'
    parameters:
      base_path: 'configuration/mods/run/td_jsp/run.yml'
      mods: [ ]

rl_agents: &rl_agents
  [
    'rl/trainer/dqn.yml',
    'rl/trainer/ddqn.yml'
  ]

memory: &memory
  [
    ['memory/plain.yml', 'memory/small.yml'],
    ['memory/prioritized.yml', 'memory/small.yml'],
  ]

loss: &loss
  [
    'loss/huber.yml',
  ]

agent: &agent
  [
    'rl/agent/multi_agent.yml',
    'rl/agent/single.yml',
  ]

optimizer: &optimizer
  [
    'optimizer/sgd.yml',
    'optimizer/adam.yml'
  ]

action_set: &action_set
  [
    'policy/rules/marl.yml'
  ]

reward: &reward
  - kind: 'global_tardiness'
  - kind: 'global_decomposed_tardiness'

run: &run
  mods:
    - [ 'util_70.yml' ]
    - [ 'util_80.yml' ]
    - [ 'util_90.yml' ]

task:
  kind: 'multi_task'
  n_workers: 8
  debug: False

  tasks:
    # AS
    - kind: 'multi_value'
      parameters:
        base:
          *jsp
        values:
          machine_agent:
            parameters:
              mods:
                # Reserved keywords to build GridFactory resulting a list
                __factory__:
                  # RL Trainers
                  - *rl_agents
                  # RL Agent Kind
                  - *agent
                  # Memory
                  - *memory
                  # Loss
                  - *loss
                  # Optimizer
                  - *optimizer
                  # State Encoding
                  - [
                    'encoding/indirect.yml',
                  ]
                  # Action Set
                  - *action_set
                  # Model
                  - [
                    'policy/policy/marl_as.yml'
                  ]
                  - [
                    'scheduler/exponential.yml'
                  ]

          tape:
            machine_reward:
              *reward

          run:
            parameters:
              *run

    # MR
    - kind: 'multi_value'
      parameters:
        base:
          *jsp

        values:
          machine_agent:
            parameters:
              mods:
                # Reserved keywords to build GridFactory resulting a list
                __factory__:
                  # RL Trainers
                  - *rl_agents
                  # RL Agent Kind
                  - *agent
                  # Memory
                  - *memory
                  # Loss
                  - *loss
                  # Optimizer
                  - *optimizer
                  # State Encoding
                  - [
                    'encoding/mr.yml'
                  ]
                  # Action Set
                  - *action_set
                  # Model
                  - [
                    'policy/policy/marl_mr.yml'
                  ]
                  - [
                    'scheduler/exponential.yml'
                  ]

          tape:
            machine_reward:
              *reward

          run:
            parameters:
              *run
